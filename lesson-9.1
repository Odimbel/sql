
-- 1 задание
select * from users u

desc users 

create table sample (
id serial primary key,
name varchar (255),
birthday_at date,
created_at datetime default current_timestamp,
updated_at datetime default current_timestamp on update current_timestamp
);

show tables

start transaction;

insert into sample select * from users where id = 1;

delete from users where id = 1;

commit;

select * from users u

select * from sample


-- 2 задание
select * from products p 

select * from catalogs c 

create or replace view prod_cat 
	as select p.name as prod, c.name cat
		from products as p
			join catalogs as c 
				on p.catalog_id = c.id;
			
select * from prod_cat


-- 3 задание

create table posts ( 
	id serial primary key,
	name varchar (50),
	created_at date not null
	);

show tables;

insert into posts values
(null, 'один', '2018-08-01'),
(null, 'два', '2018-08-04'),
(null, 'три', '2018-08-06'),
(null, 'четыре', '2018-08-17');

select * from posts;

create table last_days ( 
			day int);
	
insert into last_days values
(0), (1), (2), (3), (4), (5), (6), (7), (8), (9), (10),
(11), (12), (13), (14), (15), (16), (17), (18), (19),
(20), (21), (22), (23), (24), (25), (26), (27), (28),
(29), (30);

select * from last_days

select date(date('2018-08-31') - interval l.day day) as day 
	from last_days as l
		order by day;

select date(date('2018-08-31') - interval l.day day) as day,
	not isnull(p.name) as order_day -- определение столбцов 2х таблиц
from last_days as l
	left join posts as p
		on date(date('2018-08-31') - interval l.day day) = p.created_at
	order by day;


-- 4 задание
drop table posts

create table posts ( 
	id serial primary key,
	name varchar (50),
	created_at date not null
	);

insert into posts values
(null, 'один', '2018-11-01'),
(null, 'два', '2018-11-04'),
(null, 'три', '2018-11-06'),
(null, 'четыре', '2018-11-07'),
(null, 'пять', '2018-11-08'),
(null, 'шесть', '2018-11-10'),
(null, 'семь', '2018-11-11'),
(null, 'восемь', '2018-11-12'),
(null, 'девять', '2018-11-15'),
(null, 'десять', '2018-11-20');

select * from posts

start transaction;

select count(*) from posts;

delete from posts	
	order by created_at limit 5

commit

select * from posts
